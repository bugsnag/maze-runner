<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/cucumber.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/cucumber.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="stepdefinition_list_link"
        href="stepdefinition_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Maze+Runner+-F0-9F-8F-83">Maze Runner üèÉ</h1>

<p>A test runner for validating requests</p>

<h2 id="label-How+it+works">How it works</h2>

<p>The test harness launches a mock API which awaits requests from sample
applications. Using the runner, each scenario is executed and the requests
are validated to have to correct fields and values. Uses Gherkin and
Cucumber under the hood to draft semantic tests.</p>

<h2 id="label-Setting+up+a+new+project">Setting up a new project</h2>

<h3 id="label-First+time+setup+and+running+locally">First time setup and running locally</h3>
<ol><li>
<p>Install the <code>bundler</code> gem:</p>
</li></ol>

<p><code>    gem install bundler </code></p>
<ol><li>
<p>Add a Gemfile to the root of your project:</p>
</li></ol>

<p>‚Äú`ruby  source ‚Äú<a href="https://rubygems.org">rubygems.org</a>‚Äù</p>

<p>gem ‚Äúbugsnag-maze-runner‚Äù, git: ‚Äú<a
href="https://github.com/bugsnag/maze-runner">github.com/bugsnag/maze-runner</a>‚Äù
‚Äú`</p>
<ol><li>
<p>Run <code>bundle install</code> to fetch and install Maze Runner</p>
</li><li>
<p>Run <code>bundle exec bugsnag-maze-runner init</code> from the root of your
project to build the  basic structure to run test scenarios.</p>
</li><li>
<p><code>features/fixtures</code>: Test fixture files, such as sample JSON
payloads</p>
</li><li>
<p><code>features/scripts</code>: Scripts to be run in scenarios. Any
environment  variables set in scenarios are passed to scripts. The
<code>MOCK_API_PORT</code>  variable is provided by default to configure
the location of the mock  server.</p>
</li><li>
<p><code>features/steps</code>: Additional steps of the form Given/When/Then
required to  complete scenarios</p>
</li><li>
<p><code>features/support</code>: Helper functions. Add any setup which should
be run  once before all of the scenarios to
<code>features/support/env.rb</code>. Any setup  which should be run before
or after each scenario can go into special  <code>Before</code> and
<code>After</code> functions respectively.</p>
</li><li>
<p><code>features/*.feature</code>: The plain text scenario specifications</p>
</li></ol>

<p>A sample feature is included after running <code>init</code>. Try it out
with</p>

<p><code>    bundle exec bugsnag-maze-runner </code></p>

<h2 id="label-Writing+features">Writing features</h2>

<p>Features should be composed as concisely has possible, reusing existing
steps as needed. The harness provides a number of reusable step definitions
for interacting with scripts, setting environment variables, and inspecting
output. Each new feature should go into a <code>.feature</code> file in the
<code>features</code> directory.</p>

<pre class="code ruby"><code class="ruby">Feature: Sinatra support

Scenario: Sinatra unhandled exception
    When I set environment variable &quot;BUGSNAG_API_KEY&quot; to &quot;a35a2a72bd230ac0aa0f52715bbdc6aa&quot;
    And I start a Sinatra app
    And I navigate to the route &quot;/syntax-error&quot;
    Then I should receive a request
    And the request is a valid for the error reporting API
    And the &quot;Bugsnag-API-Key&quot; header equals &quot;a35a2a72bd230ac0aa0f52715bbdc6aa&quot;
    And the event &quot;unhandled&quot; is true
</code></pre>

<p>This example includes a mix of the included steps as well as custom ones
specific to the library being tested. <code>When I set an environment
variable</code> is provided by default while <code>When I start a Sinatra
app</code> is defined in a custom steps file in
<code>features/steps/</code>, wrapping other included steps:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>When</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I start a Sinatra app</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='const'><span class='object_link'><a href="Runner.html" title="Runner (class)">Runner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_environment'><span class='object_link'><a href="Runner.html#environment-class_method" title="Runner.environment (method)">environment</a></span></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DEMO_APP_PORT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>DEMO_APP_PORT</span>
  <span class='id identifier rubyid_steps'>steps</span> <span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'>
    When I run the script &quot;features/fixtures/run_sinatra_app.sh&quot;
    And I wait for 8 seconds
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>

<span class='const'>When</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I navigate to the route {string}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_route'>route</span><span class='op'>|</span>
  <span class='id identifier rubyid_steps'>steps</span> <span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'>
    When I open the URL &quot;http://localhost:</span><span class='embexpr_beg'>#{</span><span class='const'>DEMO_APP_PORT</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_route'>route</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;
    And I wait for 1 second
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</code></pre>

<p>In addition, any helper functions or instance variables defined in
<code>features/support/env.rb</code> are available to step files. See the
included <code>_step.rb</code> files for examples. The files in
<code>features/support</code> are evaluated before scenarios are run, so
this is where one-time or per-scenario configuration should go.</p>

<p>‚Äú`ruby  # A helper function included with the harness to run commands and 
# only print output when the command fails  run_required_commands([
[‚Äúbundle‚Äù, ‚Äúinstall‚Äù] ])</p>

<p># Maybe shell out to something directly, if necessary  <code>echo Peanut
Butter Jelly Time</code></p>

<p># Run before every scenarios  Before do  clean_build_artifacts  end</p>

<h1 id="label-Run+after+every+scenario">Run after every scenario</h1>

<p>After do |scenario|  # Teardown scenario configuration here</p>

<p>if scenario.failed?  # Can be used to do specific cleanup if a scenario
fails  end end  ‚Äú`</p>

<h3 id="label-Step+reference">Step reference</h3>

<p>A quick, non-exhaustive overview of steps that can be used when writing
feature files.</p>

<h4 id="label-Field+path+notation">Field path notation</h4>

<p>Anywhere a <code>{field}</code>, <code>{path}</code>,
<code>{key_path}</code>, etc is denoted, it can be replaced with
dot-delimited key path to indicate the path from the root of an object to
the intended target.</p>

<p>For example, to match the name of the second objects in the the key
<code>fruits</code> below, use <code>fruits.1.name</code> as the keypath.</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fruits</span><span class='label_end'>&quot;:</span> <span class='lbracket'>[</span>
  	<span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>apple</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  	<span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cherry</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='rbracket'>]</span>
<span class='rbrace'>}</span>
</code></pre>

<h4 id="label-Script+and+docker+steps">Script and docker steps</h4>

<p>| Step | Description | |‚Äî‚Äî|‚Äî‚Äî‚Äî‚Äî-| | I set environment variable
<code>{key}</code> to <code>{value}</code> | Make an environment variable
available to any scripts which run afterwards | | I run the script
<code>{path}</code> | Runs the file denoted by <code>path</code>, which
should be relative to the <code>scripts</code> directory or custom
directory denoted by the <code>SCRIPT_PATH</code> environment variable | |
I run the script <code>{path}</code> synchronously | As above, but blocks
until the script has returned | | I start the service
<code>{service}</code> | Starts a docker service from a docker-compose file
found at <code>features/fixtures/docker-compose.yml</code> | | I wait for
<code>{time}</code> second(s) | Pauses execution for the stated time |</p>

<h4 id="label-BrowserStack+steps">BrowserStack steps</h4>

<p>BrowserStack is used to drive many of the mobile device tests written using
maze-runner. For these tests we can use a driver class and accompanying set
of steps to interface with the BrowserStack AppAutomate server.</p>

<p>The driver needs to be started within the <code>AfterConfiguration</code>
callback in the <code>features/support/env.rb</code> file, where the
arguments indicate the particular test setup:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>AfterConfiguration</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='const'><span class='object_link'><a href="AppAutomateDriver.html" title="AppAutomateDriver (class)">AppAutomateDriver</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AppAutomateDriver.html#initialize-instance_method" title="AppAutomateDriver#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_bs_username'>bs_username</span><span class='comma'>,</span> <span class='id identifier rubyid_bs_access_key'>bs_access_key</span><span class='comma'>,</span> <span class='id identifier rubyid_bs_local_id'>bs_local_id</span><span class='comma'>,</span> <span class='id identifier rubyid_device_type'>device_type</span><span class='comma'>,</span> <span class='id identifier rubyid_app_location'>app_location</span><span class='rparen'>)</span>
  <span class='gvar'>$driver</span><span class='period'>.</span><span class='id identifier rubyid_start_driver'>start_driver</span>
<span class='kw'>end</span>
</code></pre>

<p>This adds the <code>$driver</code> global variable which can be used to
write custom steps using the API provided by the
<code>Appium::Driver</code> class. Several steps are already provided:</p>

<p>| Step | Description | |‚Äî‚Äî|‚Äî‚Äî‚Äî‚Äî-| | The element <code>{element}</code> is
present | Checks that an element matching a specific ID is present on the
device screen | | I click the element <code>{element}</code> | Interacts
with a visible element on the device screen | | I send the app to the
background for <code>{timeout}</code> seconds | Puts the app into a
background state for a number of seconds. If sent to the background for 0
seconds, the app will remain there indefinitely | | I send the keys
<code>{keys}</code> to the element <code>{element}</code> | Writes a string
into an on-screen element |</p>

<h4 id="label-Network+steps">Network steps</h4>

<p>| Step | Description | |‚Äî‚Äî|‚Äî‚Äî‚Äî‚Äî-| | I wait for the host <code>{host}</code>
to open port <code>{port}</code> | Repeatedly attempts to connect to a
given port on a host, timing out and stopping the test after a certain
period if the port isn&#39;t accepting connections | | I open the URL
<code>{url}</code> | Sends a request to the given url |</p>

<h4 id="label-API+helper+steps">API helper steps</h4>

<p>The following steps are quick validations that ensure a received payload is
valid for whichever API it is being sent to, but checking that specific
elements and headers are present.</p>

<p>| Step | Description | |‚Äî‚Äî|‚Äî‚Äî‚Äî‚Äî-| | The request is valid for the error
reporting API version <code>{payload_version}</code> for the
<code>{notifier_name}</code> notifier | Validates for the error-reporting
API for a particular payload version and notifier | | The request is valid
for the Build API | Validates for the Build API | | The request is valid
for the Android Mapping API | Validates for the Android Mapping API | | The
request is valid for the session reporting API version
<code>{payload_version}</code> for the <code>{notifier_name}</code>
notifier | Validates for the session-tracking API for a particular payload
version and notifier |</p>

<h4 id="label-Handling+requests">Handling requests</h4>

<p>| Step | Description | |‚Äî‚Äî|‚Äî‚Äî‚Äî‚Äî-| | I wait to receive
<code>{request_count}</code> request(s) | Waits for the number of requests
to be received, timing out after 30 seconds | | I should receive no
requests | Verifies that no requests have been received | | I discard the
oldest request | Pops the earliest received request off the stack, enabling
access to requests received afterwards | | The payload field
<code>{path}</code> is stored as the value <code>{key}</code> | Extracts a
value found at <code>path</code> in the current payload, storing it under
the <code>key</code> for later use | | The payload field
<code>{path}</code> equals the stored value <code>{key}</code> | Compares a
value found at <code>path</code> in the current payload and compares it
against a value previously stored under <code>key</code> | | The payload
field <code>{path}</code> does not equal the stored value
<code>{key}</code> | Compares a value found at <code>path</code> in the
current payload and compares it against a value previously stored under
<code>key</code> |</p>

<h4 id="label-Testing+payload+values">Testing payload values</h4>

<p>These steps are a non-exhaustive list of ways to test the values received
within a payload. All tests target the oldest received payload, see above
for testing multiple requests.</p>

<p>| Step | Description | |‚Äî‚Äî|‚Äî‚Äî‚Äî‚Äî-| | The payload field
<code>{key_path}</code> is <code>{literal}</code> | Tests the value matches
a literal. Values include <code>true</code>, <code>false</code>,
<code>null</code>, <code>not null</code> | | The payload field
<code>{key_path}</code> equals <code>{number}</code> | Tests the value
equals a number. Other possible comparisons include <code>is greater
than</code> and <code>is less than</code> | | The payload field
<code>{key_path}</code> equals <code>{string}</code> | Tests the value
equals a string. Other possible comparisons include <code>starts
with</code> and <code>ends with</code> | | The payload field
<code>{key_path}</code> is an array with <code>{number}</code> elements |
Tests an array for size | | The payload field <code>{key_path}</code>
matches the regex <code>{regex}</code> | Tests the value matches a regex |
| Each element in payload field <code>{key_path}</code> has
<code>{internal_path}</code> | Tests that each element in an array has a
valid value at its <code>internal_path</code> |</p>

<p>Most of these steps exist in forms that allow for quick testing of event
values and session values in predefined places. These prepend a path onto
the given key path. See <a
href="/lib/features/steps/error_reporting_steps.rb">error_reporting_steps</a>
and <a
href="/lib/features/steps/session_tracking_steps.rb">session_tracking_steps</a>
for full details.</p>

<p>Similar steps are also available for testing multi-part requests, query
parameters, and headers. See <a
href="/lib/features/steps/request_assertion_steps.rb">request_assertion_steps</a>
for full details.</p>

<h4 id="label-On+matching+JSON+templates">On matching JSON templates</h4>

<p>For the following steps:</p>

<pre class="code ruby"><code class="ruby">Then the payload body matches the JSON fixture in &quot;features/fixtures/template.json&quot;
Then the payload field &quot;items.0.subset&quot; matches the JSON fixture in &quot;features/fixtures/template.json&quot;
</code></pre>

<p>The template file can either be an exact match or specify regex matches for
string fields. For example, given the template</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fruit</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>apple</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>color</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\w+</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
</code></pre>

<p>The following request will match:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fruit</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>apple</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>color</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>red</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
</code></pre>

<p>Though this request will not match:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fruit</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>apple</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>color</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>red-orange</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
</code></pre>

<p>If ‚ÄúIGNORE‚Äù is specified as a value in a template, that value will be
ignored in requests.</p>

<p>Given the following template:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fruit</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>apple</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IGNORE</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
</code></pre>

<p>This request will match:</p>

<pre class="code ruby"><code class="ruby"><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fruit</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>apple</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some nonsense</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
</code></pre>

<h2 id="label-Running+features">Running features</h2>

<p>Run the entire suite using <code>bundle exec bugsnag-maze-runner</code>.
Alternately, you can specify specific files to run:</p>

<pre class="code ruby"><code class="ruby">bundle exec bugsnag-maze-runner features/something.feature
</code></pre>

<p>Add the <code>--verbose</code> option to print script output and a trace of
what Ruby file is being run.</p>

<h2 id="label-Troubleshooting">Troubleshooting</h2>

<h3 id="label-Logging">Logging</h3>

<p>Maze-runner contains a Ruby logger connected to <code>STDOUT</code> that
will attempt to log several events that occur during the testing
life-cycle. By default the logger is set to report <code>WARN</code> level
events or higher, but will log <code>DEBUG</code> level events if the
<code>VERBOSE</code> or <code>DEBUG</code> flags are set.</p>

<p>| Log Level | Event | Information | |‚Äî‚Äî‚Äî‚Äì|‚Äî‚Äî-|‚Äî‚Äî‚Äî‚Äî-| | <code>DEBUG</code> |
An error occurs when attempting to open a URL | The error information | |
<code>DEBUG</code> | When a command is run | The command string, any
<code>STDOUT</code> and <code>STDERR</code> output, and the exit code | |
<code>DEBUG</code> | A request is received | The request method, uri,
headers and body | | <code>WARN</code> | The server has not received the
desired number of requests | The array of received requests | |
<code>WARN</code> | Sleep steps are used | A warning to avoid using sleep
where possible | | <code>WARN</code> | A Selenium
<code>StaleElementReferenceError</code> occurs | The error information | |
<code>WARN</code> | A run command fails | The output from the command | |
<code>FATAL</code> | The webserver is not running at the start of a test |
Error notification before exiting |</p>

<h3 id="label-Known+issues">Known issues</h3>
<ul><li>
<p>Testing on iOS sometimes fails while Android Studio or gradle or some
Android  emulators are running.</p>
</li><li>
<p>Payload field matching for raw string values can be ambiguous when there is
a  possible regex match (e.g. when using ‚Äú.‚Äù as a part of an expected value
without escaping it).</p>
</li></ul>

<h2 id="label-Contributing">Contributing</h2>

<p>If steps would be useful for different projects running the maze, add the
to <code>lib/features/steps/</code>. If there are useful helper functions,
add them to <code>lib/features/support/*.rb</code>.</p>

<h3 id="label-Running+the+tests">Running the tests</h3>

<p>bugsnag-maze-runner uses test-unit and minunit to bootstrap itself and run
the sample app suites in the test fixtures. Run <code>bundle exec
rake</code> to run the suite.</p>
</div></div>

      <div id="footer">
  Generated on Thu Sep 26 11:47:31 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>